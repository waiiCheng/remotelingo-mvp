# 🚀 RemoteLingo - Supabase 设置指南

## ⚡ 30 分钟完成数据库搭建

---

## Step 1: 创建 Supabase 项目 (5分钟)

### 1.1 注册账号
访问: https://supabase.com
- 使用 GitHub 账号登录（最快）
- 或者邮箱注册

### 1.2 创建项目
1. 点击 "New Project"
2. 填写信息:
   - **Name**: `RemoteLingo`
   - **Database Password**: 保存好这个密码！（你会需要它）
   - **Region**: 选择离你最近的（建议：美国东部或新加坡）
   - **Pricing Plan**: Free（足够用了）

3. 点击 "Create new project"
4. 等待 2-3 分钟初始化

---

## Step 2: 创建数据表 (10分钟)

### 2.1 执行 SQL 脚本

1. 在 Supabase Dashboard，左侧找到 **SQL Editor**
2. 点击 "New Query"
3. 复制粘贴以下 SQL 代码:

```sql
-- RemoteLingo Jobs Table
create table jobs (
  id bigint generated by default as identity primary key,

  -- Basic Info
  title text not null,
  company text not null,
  logo text default 'RL',
  color text default 'bg-blue-600',

  -- Language Requirements
  languages text[] not null, -- e.g. ['Chinese (Mandarin)', 'English']
  level text default 'Fluent', -- 'Native', 'Fluent', 'Business'

  -- Compensation
  salary_min integer not null,
  salary_max integer not null,
  currency text default 'USD', -- 'USD', 'EUR', 'GBP'

  -- Location & Type
  location text not null,
  type text not null, -- 'Full-time', 'Contract', 'Freelance', 'Part-time'

  -- Job Details
  tags text[] default '{}', -- ['React', 'Python', etc.]
  apply_url text,
  description text,

  -- Metadata
  posted_at text default 'Just now',
  featured boolean default false,

  -- AI Fields
  ai_verified boolean default false,
  source text default 'Manual',
  match_score integer default 85,
  summary text,

  -- Timestamps
  created_at timestamp with time zone default timezone('utc'::text, now()),
  updated_at timestamp with time zone default timezone('utc'::text, now())
);

-- Enable Row Level Security (RLS)
alter table jobs enable row level security;

-- Create policy to allow public read access
create policy "Public jobs are viewable by everyone"
  on jobs for select
  using ( true );

-- Create policy to allow authenticated insert (for later when you add auth)
create policy "Authenticated users can insert"
  on jobs for insert
  with check ( true ); -- 暂时允许所有人，后面可以改成 auth.role() = 'authenticated'

-- Create updated_at trigger
create or replace function update_updated_at_column()
returns trigger as $$
begin
  new.updated_at = now();
  return new;
end;
$$ language plpgsql;

create trigger update_jobs_updated_at before update on jobs
  for each row execute procedure update_updated_at_column();

-- Create index for faster queries
create index jobs_languages_idx on jobs using gin(languages);
create index jobs_type_idx on jobs(type);
create index jobs_featured_idx on jobs(featured);
create index jobs_created_at_idx on jobs(created_at desc);
```

4. 点击 **Run** (或按 `Ctrl+Enter`)
5. 看到 "Success. No rows returned" 就对了！

### 2.2 验证表创建成功

1. 左侧点击 **Table Editor**
2. 应该能看到 `jobs` 表
3. 点进去，应该看到所有的列

---

## Step 3: 获取 API 密钥 (5分钟)

### 3.1 找到你的凭据

1. 左侧点击 **Project Settings** (齿轮图标)
2. 点击 **API**
3. 你会看到:

```
Project URL: https://xxxxxxxxxxxxx.supabase.co
anon public key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
service_role key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... (不要公开！)
```

### 3.2 保存到前端项目

打开 `frontend/.env.local` 文件，替换内容为:

```env
NEXT_PUBLIC_SUPABASE_URL=https://你的项目ID.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=你的anon_key（很长的那个）
```

**重要**:
- 用你实际的 URL 和 Key 替换
- `anon` key 是安全的，可以放在前端
- **不要** 把 `service_role` key 放在前端！

---

## Step 4: 手动添加测试数据 (10分钟)

### 4.1 快速测试 - 添加 1 条数据

1. 在 Supabase，点击 **Table Editor** > `jobs`
2. 点击 **Insert** > **Insert row**
3. 填入数据:

```
title: Senior Full Stack Engineer
company: TechFlow EU
languages: {"Chinese (Mandarin)", "English"}  (注意是大括号，逗号分隔)
level: Native/Fluent
salary_min: 75000
salary_max: 110000
currency: EUR
location: Remote (EU Timezone)
type: Full-time
tags: {"React", "Node.js", "Fintech"}
apply_url: https://example.com/apply
featured: true (勾选)
ai_verified: true (勾选)
source: Direct Career Page
match_score: 98
summary: Requires native Mandarin for APAC banking integration team.
```

4. 点击 **Save**

### 4.2 验证数据

在 SQL Editor 运行:
```sql
select * from jobs;
```

应该能看到你刚添加的职位！

---

## Step 5: 批量导入数据 (可选)

### 使用 CSV 导入 (最快方法)

1. 创建一个 Excel/Google Sheets
2. 列名必须和数据库字段一致:
   ```
   title, company, languages, salary_min, salary_max, location, type, ...
   ```

3. 在 Supabase Table Editor:
   - 点击 **⋯** (更多选项)
   - 选择 **Import data via spreadsheet**
   - 上传你的 CSV

**注意**: 数组字段（languages, tags）格式为:
```
{"Chinese","English"}
```

---

## ✅ 验证清单

完成后，你应该能：

- [ ] 在 Supabase Dashboard 看到 `jobs` 表
- [ ] 表里至少有 1 条测试数据
- [ ] `.env.local` 文件包含正确的 URL 和 Key
- [ ] 运行 `select * from jobs;` 能看到数据

---

## 🚀 下一步

现在数据库已准备好，继续:
1. 安装 Supabase 客户端: `npm install @supabase/supabase-js`
2. 修改前端代码以连接 Supabase
3. 测试数据加载

详见: `SUPABASE_INTEGRATION.md`

---

## 🐛 常见问题

### Q: SQL 执行报错？
A: 确保 SQL 代码完整复制，没有遗漏分号

### Q: 看不到 jobs 表？
A: 刷新页面，或者检查 SQL 执行结果

### Q: Insert row 时 languages 字段报错？
A: 格式应该是 `{"语言1", "语言2"}`，用大括号和引号

### Q: 忘记保存 API Key？
A: 在 Project Settings > API 随时可以找回

---

## 💰 费用说明

**Free Tier 包含**:
- 500 MB 数据库存储
- 1 GB 文件存储
- 50 MB 数据库带宽/天
- 2 GB 文件带宽/天

**对于 RemoteLingo**:
- 500 条职位 ≈ 5 MB
- 完全够用！
- 每月 0 美元 💰

---

**完成时间**: 约 30 分钟
**难度**: ⭐⭐☆☆☆ (简单)

准备好后，运行前端项目并测试！🚀
